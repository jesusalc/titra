# ; How to set up titra CENTOS REF: https://satishgandham.com/2017/11/installing-meteor-node-js-app-cpanelwhm-based-dedicated-server-vps/
upstream titra {
    # Path to Puma SOCK file, as defined previously
    # server unix:///home/zeus/_/work/ubemax/projects/titra/shared/sockets/puma.sock fail_timeout=0;
    server 127.0.0.1:4005 fail_timeout=0;
    # server unix:/home/zeus/_/work/ubemax/projects/titra/shared/sockets/puma.sock;
    # server unix:///home/zeus/_/work/ubemax/projects/titra/sockets/puma.sock fail_timeout=0;
}

server {
    listen 80;
    server_name titra.test www.titra.test *.titra.test;
    charset utf-8;
    # serve static files
    # location ~ ^/(img|javascript|js|css|flash|media|static|libraries|assets-pipe)/ {
    #  root /home/zeus/_/work/ubemax/projects/titra/public;
    #  expires 30d;
    # }

    root /home/zeus/_/work/ubemax/projects/titra/public;

    # try_files $uri/index.html $uri @app;

    #location ~* \.(jpg|jpeg|png|svg|ico)$ {
    #  root /home/zeus/_/work/ubemax/projects/titra/public/images;
    # alias /home/zeus/_/work/ubemax/projects/titra/public/images;
    #  gzip_static on;
    #  gzip on;
    #  expires max;
    #  add_header Cache-Control public;
    #}
    #location ^/assets/*.(jpg|jpeg|png|svg)$ {
       #gzip_static on;
       #expires max;
    #   access_log off; log_not_found off;
    #   alias /home/zeus/_/work/ubemax/projects/titra/public/images;

# ls -p1 | grep -v / | xargs -I {} echo "    location = /{} {
#         access_log off; log_not_found off;
#         alias $(pwd)/{};
#     }"
    error_page 500 502 503 504 /500.html;
    location = /404.html {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/404.html;
    }
    location = /410.html {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/410.html;
    }
    location = /422.html {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/422.html;
    }
    location = /500.html {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/500.html;
    }
    location = /offline.html {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/offline.html;
    }
    location = /robots.txt {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/robots.txt;
    }
    location = /sw.js {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/sw.js;
    }
    location = /sitemaps/sitemap.xml.gz {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/tmp/sitemaps/sitemap.xml.gz;
    }
    location = /android-chrome-192x192.png {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/favicons/android-chrome-192x192.png;
    }
    location = /android-chrome-512x512.png {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/favicons/android-chrome-512x512.png;
    }
    location = /apple-touch-icon.png {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/favicons/apple-touch-icon.png;
    }
    location = /browserconfig.xml {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/favicons/browserconfig.xml;
    }
    location = /favicon-16x16.png {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/favicons/favicon-16x16.png;
    }
    location = /favicon-32x32.png {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/favicons/favicon-32x32.png;
    }
    location = /favicon.ico {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/favicons/favicon.ico;
    }
    location = /manifest.json {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/favicons/manifest.json;
    }
    location = /mstile-150x150.png {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/favicons/mstile-150x150.png;
    }
    location = /appgrid-128x128.svg {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/img/appgrid-128x128.svg;
    }
    location = /grain-24x24.svg {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/img/grain-24x24.svg;
    }
    location = /market-150x150.svg {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/img/market-150x150.svg;
    }
    location = /market-big-300x300.svg {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/img/market-big-300x300.svg;
    }
    location = /wekan.png {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/img/wekan.png;
    }
    try_files $uri/index.html $uri @titra;

    #location /admin {
    #   auth_basic           "Super Administrator's Area";
    #   auth_basic_user_file /home/zeus/_/work/ubemax/projects/titra/.htpasswd;
    #location /login {
    #   auth_basic           "Administrator's Area";
    #   auth_basic_user_file /home/zeus/_/work/ubemax/projects/titra/.htpasswd;
    #}
    #location /accounts {
    #   auth_basic           "Accounts's Area";
    #   auth_basic_user_file /home/zeus/_/work/ubemax/projects/titra/.htpasswd;
    #}



    location @titra {
        proxy_pass http://titra;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $http_host;
        proxy_set_header X-Forwarded-Proto http;
        proxy_redirect off;
    }

    client_max_body_size 4G;
    keepalive_timeout 10;
}
# REF: https://gist.github.com/tadast/9932075  see this script about how to build the script from ground up and read the comments
# REF: https://gist.github.com/rkjha/d898e225266f6bbe75d8  See that script as reference for these confs and read the comments
server {
    listen  443 ssl;
    server_name titra.test www.titra.test *.titra.test;
    charset utf-8;

    # serve static files
    # location ~ ^/(img|javascript|js|css|flash|media|static|libraries|assets-pipe)/ {
    #  root /home/zeus/_/work/ubemax/projects/titra/public;
    #  expires 30d;
    # }


    root /home/zeus/_/work/ubemax/projects/titra/public;

    # Additional rules go here.
    # ssl on;   [warn] the "ssl" directive is deprecated, use the "listen ... ssl"
    ssl_certificate /home/zeus/.valet/Certificates/titra.test.crt;
    ssl_certificate_key /home/zeus/.valet/Certificates/titra.test.key;

    ssl_session_timeout  5m;

    #location ~* \.(jpg|jpeg|png|svg|ico)$ {
    #  root /home/zeus/_/work/ubemax/projects/titra/public/images;
      # alias /home/zeus/_/work/ubemax/projects/titra/public/images;
    #  gzip_static on;
    #  gzip on;
    #  expires max;
    #  add_header Cache-Control public;
    #}
    #location ^/assets/*.(jpg|jpeg|png|svg)$ {
       #gzip_static on;
       #expires max;
    #   access_log off; log_not_found off;
    #   alias /home/zeus/_/work/ubemax/projects/titra/public/images;
       #add_header Cache-Control public;
    #}

    error_page 500 502 503 504 /500.html;
    location = /404.html {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/404.html;
    }
    location = /410.html {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/410.html;
    }
    location = /422.html {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/422.html;
    }
    location = /500.html {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/500.html;
    }
    location = /offline.html {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/offline.html;
    }
    location = /robots.txt {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/robots.txt;
    }
    location = /sw.js {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/sw.js;
    }
    location = /sitemaps/sitemap.xml.gz {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/tmp/sitemaps/sitemap.xml.gz;
    }
    location = /android-chrome-192x192.png {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/favicons/android-chrome-192x192.png;
    }
    location = /android-chrome-512x512.png {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/favicons/android-chrome-512x512.png;
    }
    location = /apple-touch-icon.png {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/favicons/apple-touch-icon.png;
    }
    location = /browserconfig.xml {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/favicons/browserconfig.xml;
    }
    location = /favicon-16x16.png {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/favicons/favicon-16x16.png;
    }
    location = /favicon-32x32.png {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/favicons/favicon-32x32.png;
    }
    location = /favicon.ico {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/favicons/favicon.ico;
    }
    location = /manifest.json {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/favicons/manifest.json;
    }
    location = /mstile-150x150.png {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/favicons/mstile-150x150.png;
    }
    location = /appgrid-128x128.svg {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/img/appgrid-128x128.svg;
    }
    location = /grain-24x24.svg {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/img/grain-24x24.svg;
    }
    location = /market-150x150.svg {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/img/market-150x150.svg;
    }
    location = /market-big-300x300.svg {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/img/market-big-300x300.svg;
    }
    location = /wekan.png {
        access_log off; log_not_found off;
        alias /home/zeus/_/work/ubemax/projects/titra/public/img/wekan.png;
    }

    try_files $uri/index.html $uri @titra;

    location @titra {
        proxy_pass http://titra;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $http_host;
        proxy_set_header X-Forwarded-Proto https;
        proxy_redirect off;
    }

    # location ~ "^/images/" {
    #  root /home/zeus/_/work/ubemax/projects/titra/public;
    #  gzip_static on;
    #  expires max;
    #  add_header Cache-Control public;
    # }

    client_max_body_size 4G;
    keepalive_timeout 10;
}





# server {
#     listen 80;
#     server_name titra.test www.titra.test *.titra.test;
#     return 301 https://$host$request_uri;
# }

# server {
#     listen 443 ssl http2;
#     server_name titra.test www.titra.test *.titra.test;
#     root /;
#     charset utf-8;

#     location /41c270e4-5535-4daa-b23e-c269744c2f45/ {
#         internal;
#         alias /;
#         try_files $uri $uri/;
#     }

#     ssl_certificate /home/zeus/.valet/Certificates/titra.test.crt;
#     ssl_certificate_key /home/zeus/.valet/Certificates/titra.test.key;

#     location / {
#         rewrite ^ /home/zeus/.config/composer/vendor/cpriego/valet-linux/server.php last;
#     }

#     location = /favicon.ico { access_log off; log_not_found off; }
#     location = /robots.txt  { access_log off; log_not_found off; }

#     access_log off;
#     error_log /home/zeus/.valet/Log/nginx-error.log;

#     error_page 404 /home/zeus/.config/composer/vendor/cpriego/valet-linux/server.php;

#     location ~ \.php$ {
#         fastcgi_buffering off;
#         fastcgi_split_path_info ^(.+\.php)(/.+)$;
#         fastcgi_pass unix:/home/zeus/.valet/valet.sock;
#         fastcgi_index /home/zeus/.config/composer/vendor/cpriego/valet-linux/server.php;
#         include fastcgi_params;
#         fastcgi_param SCRIPT_FILENAME /home/zeus/.config/composer/vendor/cpriego/valet-linux/server.php;
#     }

#     location ~ /\.ht {
#         deny all;
#     }
# }

# server {
#     listen 88;
#     server_name titra.test www.titra.test *.titra.test;
#     root /;
#     charset utf-8;
#     client_max_body_size 128M;

#     location /41c270e4-5535-4daa-b23e-c269744c2f45/ {
#         internal;
#         alias /;
#         try_files $uri $uri/;
#     }

#     location / {
#         rewrite ^ /home/zeus/.config/composer/vendor/cpriego/valet-linux/server.php last;
#     }

#     access_log off;
#     error_log /home/zeus/.valet/Log/nginx-error.log;

#     error_page 404 /home/zeus/.config/composer/vendor/cpriego/valet-linux/server.php;

#     location ~ \.php$ {
#         fastcgi_buffering off;
#         fastcgi_split_path_info ^(.+\.php)(/.+)$;
#         fastcgi_pass unix:/home/zeus/.valet/valet.sock;
#         fastcgi_index /home/zeus/.config/composer/vendor/cpriego/valet-linux/server.php;
#         include fastcgi_params;
#         fastcgi_param SCRIPT_FILENAME /home/zeus/.config/composer/vendor/cpriego/valet-linux/server.php;
#     }

#     location ~ /\.ht {
#         deny all;
#     }
# }

